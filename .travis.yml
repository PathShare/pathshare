sudo: false
language: python
python:
- '3.6'
cache:
  directories:
  - "$HOME/google-cloud-sdk/"
services:
- docker
install:
- cd backend
- python -m pip install -e .
- pip install pipenv
- pipenv install --dev
before_deploy:
- if [ ! -d "$HOME/google-cloud-sdk/bin" ]; then rm -rf $HOME/google-cloud-sdk; export CLOUDSDK_CORE_DISABLE_PROMPTS=1; curl https://sdk.cloud.google.com | bash; fi
- source /home/travis/google-cloud-sdk/path.bash.inc
- gcloud --quiet version
- gcloud --quiet components update
- gcloud --quiet components install kubectl
script:
- pipenv run pytest --cov=./ --show-progress
env:
  global:
  - GOOGLE_APPLICATION_CREDENTIALS=~/gcloud-service-key.json
  - CLOUDSDK_COMPUTE_ZONE=us-central1-a
  - DOCKER_IMAGE_NAME=pathshare_backend
  - KUBE_DEPLOYMENT_NAME=pathshare_backend
  - KUBE_DEPLOYMENT_CONTAINER_NAME=pathshare_backend
  - secure: Sm+CA+pTqr5MJi8tLu2RZPMqAvmLdm0yjn4BlyQqO1T3Om4bj3IPuXtuHF63DvWOk7WHmXgiUNFaBKAeis6z/sLr5XjlxsgDMd7kGZxgUiRD/pR9sPCHMubh4aHcMpzVpE4C9xjGJQpWoKlXp4tupdWx8deDoqr4rc/MyrMQ7vju8Xr9qmcadoaHcGccXhC1+1YM+azRI199Nv7UViLeOKUkOhEM5zFZK8SQkoWhs/Qk6+nLgSozYcbKxKgfmWzem4jgBVnP0Te1iCXm6ztg1G/hssxFOGNYhLIdBXVLXATwMGG72Bo04RK8jCnapmSIW0YtUvMMlXKhd6ONuKlXiOb5i/bNpz8GUp1xnxKwSs21ydzbbMwNXeekWYX0nVdm13BxtmrYAa5sqD7DsB5x+KG5njHj3yRoqO4Rt4NDVNzbGt2fOx7SnGyzCXWKbySDnEc7zHf975AJnNeGntIjhfm/KQ9XivbQmEJ0w0SwpW2nrgEbZkv/J9jAgOUHu4UtIlciO150vuSwlk6UpkoMFCcTl6q0jPuvIgNFa1mYCtuSLlniGFjy0710ECHzK+adkAPaps3xwSZmuAG3EIPnSAFzuhRyTua6QnyEEY8ilsHRCv8DMyD5EJQIsJMVwCrAr5hkij+N9F5/ya0ZS6wRjkR6U9X33/sG5MxYU+Oc7Ho=
  - secure: LZzE2oINXUzhSHH+TwQUWjPDTL9LOW4NBkLPcVPC4uxtuYXSjOWEiPQiyWphPB70NrOkKKSKmWkh6FIV89T8Aqjm2vwdHqIblUevviVSgFXtcS1FFO+oHiuHS+65bKhAcMwPnmsyl7vrlugwd6o4pnTS+EAcCUtAdCgdNFgEJZK3DxztJDW/UMzqM7HmBi76Uyouy/+Y6Q0DW3BhIoRdbqkznA/mxxyn9gSi4VqTMyOanK8I8dR8ZzPrChuG1npUV7dPMKh2RwIl1T00s4UBocRDReeyXx5IkFLZiJ7epkQken9nkagN0NJs0ZGTDOMMUA/2Sqb5ZIBTZpeOr87mYeTQdwvXrMAMOmIoxZfYZkR9mIPgJB/35KNFVhMzhqyvW+i58xFF1rZStdtCWJzlJ/nM/a3owLbDctme9GHg9H0pBVo7POZHhMDR9CoMymw+NwMWY5rg5VHTCHxhJjROK0Xle8qmZCCNwlqrI4eGVgm/iCs7ybDYFg+aPHQSxeK0l7moD0Wn4rbLRAR1ROGB/qUSbnINPqXmRpZ0MODSzgi9MjtIJ9I6jMaip9WToYrhpbmrgrE2OMR7JjelgSc0Uilc+LfMbbFXuhxBxFSA9L02CVXYsZ8WkjiAnsIeKm0tB/UGZ+hAyZ1LR1Tik8wEPaHeHVh2zG1eEpiJc67V5l0=
  - secure: gWrsbzt4XBS5+Ihew2PzAjSzsqgPyp+SHoVOurtsf8E/+QopMijGlDU8noJ42yOgp9BMQtCZzDtMg87Td0gkp+8MGe1RHLoNyvnwSXBtZ3M6qxrY585raRUFjwOalThun9eolj+370GbZqWgsZ8qRXE0iQJlIQhqD6sT7pT7ETN97CVWs9kRiuamB7w7yFH7l5YFADVjDGrFyjEG8hAdlJDgjECm8mJ3raoEpOQw77fQQ94+JvmqFpVKnICBIXQwVgCutD0roreXi4Ee/5VFDdAkrIwjTz4VdXUzGBg1KzfrFBY6VpujR95Tt6Hndy69THQ8OtAg2q+uSbX5tBJVLSPuIeKOyoHwQuyPj529oSgrWTeC0uDA1wQoUPR/uQAenzfigETV7x50bGhucYWFtJg6AecdY6eo0Jo8RV04DPCzlA53pClG0qVTvO6T4bSfMAlyhQ50PulFgbNJsZ5lPVTtIXndkwhRMNhQNTc1sqeJJAo5pK1+JNueKtp12JUy1XVhkz0a1x2Jj/wjYsxlQCIa8J8gzIL2vEH2bIcacK7qQKDFDOaU+wyZwXyav4RT7UvgmmOWrdjshw2kEsIik0KjI9SPzzBjJXh/vIlKau2UGMw75F9M9OFqHjVCkzJ/Kn3b2k8s4mLKILloGwmr+tQuE52R7RtYYu2GkIEu2cY=
  - secure: ZmqwPAStpbQ57V3m97MHF8ICwKC68yik1vnJmSA/sIEykcy1wy1uqf86ymIj7XfB+p2rHEIdHM2J3Dy2CtX8qU8mwNCvUPb7CXrYZli8RS5fm6GcFBfsx6gYvhMXyWcombZIXukVBWLESusQKyTTPcN1RIS6/iuomML9bse9fmKlbkUmDvokBjxEQoqPJdeNPxEMdE0G4AlzQnPpnvN0OjtHxHP32s418vKEFqbEGaJxWsv0D8vhzpCm3P6q9qGPsXKMV+YDyVNP3WZ1nZVLkzcJ4lHtfmYworN84cz4AeU79wotemZZ0ixBR9m4qjcr+pgAZnHQAkQIdrD6GA48SFkJy66ybafmiEsdV3uTolVX1GK/Y52A3dIOQ0kjq7tCl38MLb+JxFJa+Z2IObaU1sc0JkANV7fKVn75cur9Qgl8tyT4tsGzwmF1ut408LPjBsZPmA4wQj7O2Pwmn4O3rRCoFvjR13McS3yPdEUEnmeAE83J0GLEWZfTj4/SdPO430PRVYN9rYWf8JS+HyQ4Xv6rKZTHtbF1eDLOsBSmfx5rRgfNzg55tQwO5qd7i7TYnLBxazRhYDxyWxZpbG0UcW4+YdKHEB0b75PJD6DonZDGSKFCMPjJ0yGzXuqejWMBXS5kT8tBHgRogkQF52iOAipN2mlDNyfQ7LhA52+vQv0=
  - secure: dLVPvBlol94v+dIs3IBQH5unNsregRtjygtti5SS1CA0ZUxd6+WHZfOy5e/1KJ8IMtN7prd/vwdTpNNnkxcbzB0JRwxiYX3zqTiE4/peEJT1u1C5M/JWjL999LOLlilqVxrHXjXBXN+JXFEfDR30tHxgjNgBbPYWzMXWAZSzYyV28zxp92rX6Ysm9ZRuIUAeEGOhhfUcTduzH6z0EyCyRl1w2vR50lW0mBbTOsdOVOYV/KIW+nt6WFaCrK68GoaBDEVHGdKV5HbRUcU6zCqFfHykbnRegPysBAHp4jWaXtQEEgF0nFapWyca+wzaZBI/bXm3CaClZMHXz0mNGl4xtcAU/GXjLjMBMKejyIcGRDpo+6Zowfy5aK7kqDG5pTPs5WQtU79FHhSqQP+w5Re3MnvSmPo5rXVNH5dsNhSxUs56DZtbU4wWJSFq/tEAKzUJn8yXwITQhEtKTmXFLhglAICcjwzG+GSip2G4ekaQFDlTIphN84eSjr1M6D5bGERdpIHVwX1PhjtHVW5su5iHsk4HWEzmUpfs77M9WaUUw499vMOodpCWOufS8FLiIE65QkFGM7YnaJZYvlnVqVYM06hjK0GW+w1ICAewSQfPHfOonbQ10dUtFF55RTi355y5gawcvk4lGS3iBq/9fKdfVQho3zvbg3nB1FIvJgjU75w=
  - secure: pYsQl+3azkVbMsBU1MK3HkFKe8AtO8Gi94VqXueK+mOwZ7u1EWG2R+OFqYAEa/h4WP3DNAg8MsntAlYecOBuxCrWuJd82kXu0AU+c/9lWGM4ENTno/q8ApjhBaZp8ljqYEpzig7OrfQiHTkySV+njb2Q/UPYbaRswrOy9S/KuGjkL8r0itWzOY3MTkXdvrB7+loB/jx+nr8NwbdpzXr1SE+N8N0GqoJqeXHvXK/LzbwybLlVUqfeUiSprAr56Ug+P1K2YGNGvS48jpXt58tXFiqBpymr9HPcpkhRzsmsyui92AzP4zKq9uziDhCStrx+482ICIpk7ROfKCMmzsbh8cNFRyeMp4RCd5jUpWXNkVJO656WzJnUmokC2rVwXydqByhfjEA+MaFzuyv9sv0ucH1+ghdVRTQJQ93qL3letFch/h/B4WWa7pXkdxOgPBO4Y7IqGvymEaXyHVsk2B3em4VGLPEb0oIsDQjJpGl9+VTsQMfgWpK+NK4mdvb3UjKzz/w6UmWf190MBgfYS/s6buPC2E8lLSlJD3/+qx0SCb1IhfLXedv6UdYdpySQ1Ti0mToV5QO3N8UrhhEjBdA3ddJsoWLA+F8fEJxISERo3zp3w8r2oIoY5MungiF2Vr0DGgWtcKpncxXBMFd90c0r9E1K8Vjqvgcg2yqeZLtQxiQ=
  - secure: KKIH0ax2NZJwSu5SaEoM3OgU9ipbVa11SecuqH94g50N1YoICh/klifQOBnKQUGuhsekrrLJmppIrOl/K4233O2gLas2YQwPJKesw0I2Bq7f9PB05X8s3Fo+AOOiMvcYRwkLBvOZETh+wsgkO1o/CCZwDBaTR3ftEvbmrJVlBy+E8O0Kzi/7thPDwpItvHCDWdN7dNBff9lW8rsQ+6cfixuX5m4rZFuTT6T3evcJNBcZlN9X64RcsOeLmKv0UJ1ttau50GYynUfxxjcNTKLkYrvyYOVDFjdQ2WR47rchEpSDGVE1ixJZICWpzkFC3735idH2Fpfg+NJ12l+oIak14nSUtRoOAnn2sBaOfafkGVyGnMN5E6fWpmb6cm7IZDJQHgtDzL749UPThk4HwxH0ZH5oHPft6BpBn7A4NJzISSwthD5RPRK9PBL4rOEDxgAP9EjM9PN3ZZm4JIoRqIMa3tUZQ0AjLJwygLS/4LWLuaOvl5dGmEmbPGT2VwbLwjDr/p94/VU98/51qUXqzpAHUtU5ElqsFzQftdXvX2CmXvRJchOM6dPPNucXGhNweo+U6DK3KR2gu5QbCByIm5rh8pUAt7MwWdEBvE2fmVEVueeOYkoBfpbA0uOYcSg/Yv4+SE+/ZNDMcSXMW/aSx/aMoEbXdO2pVWWpET04zvxur+U=
  - secure: hRmp4+H39vbwOCAEzdDM5onjHH10S93nfoLUl4eXy07WGc+hMbk3TcLKgJxkdPLnd6NgWWtOHD9oWh3Lv3E/H+9H3jFIY3bniz2/5scsXS5KkXEg7qGMhth/OvGMXaE/i4vgJLPMjP5qa3/ibWEuqRQyDNNEzqLXZbYXWv39gFOvnvsEMJP/xHhe4rjXG3zlOdyz9bh12XiklF9TmEFBf0q3BCC/6ysJy4fTU1yH/4dnfHwyWzlKR34d1pVvqkVofdCiGrKKQPz8WP10qum2xe7TM6h4BjKqF7xeyT9l/6ZkTr/kMbjSbQ6NBT9ajpwZJKGREhFIdGnUVixM+PxZaPhx5pd0zgPw2FbbEQPHSsZu9Ic1m8fh8U/yE5YdKXaCiqh1xNf23x78657TEzmyC2VF2tUeBlqcByqF6ocqrH2Rpp+Kms9dWMNaCN/RRn9iwD/o/dRU/jVrZcILe0P6sgZv8x0yCv6uFLXku847IEpsMzuIsrdFbxGOnqdMVq52obLsQhGX+gHBjDPAp2BWR6LxjUYa8GgMXX44rCjXNvjd3sEC1Pr3hv1r2EliJEHgdABceRNVbY0lVSbjgQKybMMGYYUfiqvwF9u6KZR8vgFIM+QCPcsx9qvad/EujTCsg+fwiKg1gNVCbUGCPelsnpM5ypqZIwSVu9pXqCp7dts=

deploy:
- provider: script
  script: "./backend-deploy-production.sh"
  skip_cleanup: true
  on:
    branch: master
